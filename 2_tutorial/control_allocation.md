# `control_allocation`

生成控制分配矩阵

## 语法

```python
control_allocation(n, d, ku)
control_allocation(n, d, ku, **kwargs)
```

## 说明

```python
B_f = control_allocation(n, d, ku)
```

返回多旋翼飞行器的控制效率矩阵，其中`n`表示飞行器中旋翼数量，`d`表示旋翼中心距机体坐标系原点的距离，`ku`表示每个旋翼转矩系数和拉力系数的比值。

```python
B_f = control_allocation(n, d, ku, **kwargs)
```

返回多旋翼飞行器的控制效率矩阵，并使用另外一个或多个关键字参数指定其他属性。

## 示例

1. 假设一四旋翼飞行器，其旋翼中心距离机体坐标系原点距离为`d = 0.28 m`，转矩系数和拉力系数比值为`ku = 0.1`。

```python
>>> from OpenHA.assessment.attribute import control_allocation

>>> control_allocation(4, 0.28, 0.1)

array([[ 1.00000000e+00,  1.00000000e+00,  1.00000000e+00,
         1.00000000e+00],
       [ 0.00000000e+00, -2.80000000e-01, -3.42901104e-17,
         2.80000000e-01],
       [ 2.80000000e-01,  1.71450552e-17, -2.80000000e-01,
        -5.14351656e-17],
       [-1.00000000e-01,  1.00000000e-01, -1.00000000e-01,
         1.00000000e-01]])
```

---

2. 针对上述多旋翼飞行器实例，机架为 X 形，即螺旋桨\#1 的角度为$\frac{\pi}{4}$，同时放弃偏航通道控制。

```python
>>> from OpenHA.assessment.attribute import control_allocation

>>> control_allocation(4, 0.28, 0.1, init_angle=math.pi / 4, giveup_yaw=True)

array([[ 1.       ,  1.       ,  1.       ,  1.       ],
       [-0.1979899, -0.1979899,  0.1979899,  0.1979899],
       [ 0.1979899, -0.1979899, -0.1979899,  0.1979899]])
```

## 输入参数

`n` —— 标量数值，指定多旋翼飞行器中旋翼数量。

---

`d` —— 旋翼中心距机体坐标系原点的距离。

当多旋翼飞行器中所有旋翼与机体坐标系原点的距离相等时，将`d`指定为标量，如`d = 0.28`。

反之，则指定`d`为长度为`n`的一维向量，向量中每一元素指定了对应的距离，如`d = [0.28 0.35 0.28 0.35]`。

---

`ku` —— 各旋翼的转矩系数和拉力系数的比值，取标量或向量时的不同含义与参数`d`保持一致。

---

`init_angle` —— 关键字参数，默认为`0`。

当该参数为标量时，其指定了旋翼\#1 的旋翼臂与机体坐标系 x 轴正方向沿顺时针夹角的大小（弧度制），且默认所有旋翼为均匀分布，相邻两两之间夹角相等，则可计算得到所有旋翼夹角。如`n=4, init_angle=0`，则可以计算得到各旋翼臂的角度为 0、 $\frac{\pi}{2}$、$\pi$、$\frac{3\pi}{2}$。

当该参数为向量时，其长度需等于`n`，此时向量中的每一个元素则指定了对应旋翼臂的角度，如`init_angle=[pi/4, 3*pi/4, 5*pi/4, 7*pi/4]`。

---

`drct` —— 关键字参数，默认为`[1, -1, 1, -1, 1, -1]`。

长度为`n`的向量，且其中元素为`1`或者`-1`。向量中的元素指定了对应旋翼的旋转方向，其中`1`表示逆时针，`-1`表示顺时针。

---

`eta` —— $[0,1]$之间的浮点数，表示旋翼的效率系数，默认为`1`。取标量或向量时的不同含义与参数`d`保持一致。

---

`giveup_height` —— `True`或`False`，是否放弃高度通道的控制，默认为`False`。

如果为`True`，表示放弃对飞行器竖直高度通道的控制，对应地，控制分配矩阵中用于计算竖直方向拉力的第一行需要被移除。

---

`giveup_yaw` —— `True`或`False`，是否放弃偏航通道的控制，默认为`False`。

如果为`True`，表示放弃对飞行器偏航通道的控制，对应地，控制分配矩阵中用于计算偏航力矩的第四行需要被移除。

## 参考文献

[1] Q. Quan. Introdection to Multicopter Design and Control. Singapore: Springer, 2017.
